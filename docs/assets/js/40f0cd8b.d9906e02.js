"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[3026],{11470:(e,t,r)=>{r.d(t,{A:()=>A});var s=r(96540),n=r(34164),i=r(23104),a=r(56347),l=r(205),o=r(57485),d=r(31682),c=r(70679);function u(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:r}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return u(e).map((e=>{let{props:{value:t,label:r,attributes:s,default:n}}=e;return{value:t,label:r,attributes:s,default:n}}))}(r);return function(e){const t=(0,d.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function p(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function x(e){let{queryString:t=!1,groupId:r}=e;const n=(0,a.W6)(),i=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,o.aZ)(i),(0,s.useCallback)((e=>{if(!i)return;const t=new URLSearchParams(n.location.search);t.set(i,e),n.replace({...n.location,search:t.toString()})}),[i,n])]}function j(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,i=h(e),[a,o]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=r.find((e=>e.default))??r[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:i}))),[d,u]=x({queryString:r,groupId:n}),[j,f]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,i]=(0,c.Dv)(r);return[n,(0,s.useCallback)((e=>{r&&i.set(e)}),[r,i])]}({groupId:n}),y=(()=>{const e=d??j;return p({value:e,tabValues:i})?e:null})();(0,l.A)((()=>{y&&o(y)}),[y]);return{selectedValue:a,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:i}))throw new Error(`Can't select invalid tab value=${e}`);o(e),u(e),f(e)}),[u,f,i]),tabValues:i}}var f=r(92303);const y={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var m=r(74848);function g(e){let{className:t,block:r,selectedValue:s,selectValue:a,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.a_)(),c=e=>{const t=e.currentTarget,r=o.indexOf(t),n=l[r].value;n!==s&&(d(t),a(n))},u=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;t=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;t=o[r]??o[o.length-1];break}}t?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":r},t),children:l.map((e=>{let{value:t,label:r,attributes:i}=e;return(0,m.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>o.push(e),onKeyDown:u,onClick:c,...i,className:(0,n.A)("tabs__item",y.tabItem,i?.className,{"tabs__item--active":s===t}),children:r??t},t)}))})}function b(e){let{lazy:t,children:r,selectedValue:n}=e;const i=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=i.find((e=>e.props.value===n));return e?(0,s.cloneElement)(e,{className:"margin-top--md"}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:i.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==n})))})}function v(e){const t=j(e);return(0,m.jsxs)("div",{className:(0,n.A)("tabs-container",y.tabList),children:[(0,m.jsx)(g,{...t,...e}),(0,m.jsx)(b,{...t,...e})]})}function A(e){const t=(0,f.A)();return(0,m.jsx)(v,{...e,children:u(e.children)},String(t))}},19365:(e,t,r)=>{r.d(t,{A:()=>a});r(96540);var s=r(34164);const n={tabItem:"tabItem_Ymn6"};var i=r(74848);function a(e){let{children:t,hidden:r,className:a}=e;return(0,i.jsx)("div",{role:"tabpanel",className:(0,s.A)(n.tabItem,a),hidden:r,children:t})}},84390:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>c,contentTitle:()=>o,default:()=>p,frontMatter:()=>l,metadata:()=>d,toc:()=>u});var s=r(74848),n=r(28453),i=r(11470),a=r(19365);const l={title:"Validate purchase in Stripe, provide access level, and import transaction history from Stripe with server-side API",description:"",metadataTitle:"",displayed_sidebar:"APISidebar"},o=void 0,d={id:"ss-purchase-in-stripe",title:"Validate purchase in Stripe, provide access level, and import transaction history from Stripe with server-side API",description:"",source:"@site/versioned_docs/version-3.0/ss-purchase-in-stripe.md",sourceDirName:".",slug:"/ss-purchase-in-stripe",permalink:"/docs/ss-purchase-in-stripe",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"Validate purchase in Stripe, provide access level, and import transaction history from Stripe with server-side API",description:"",metadataTitle:"",displayed_sidebar:"APISidebar"},sidebar:"APISidebar",previous:{title:"Set transaction",permalink:"/docs/ss-set-transaction"},next:{title:"Add integration identifiers",permalink:"/docs/ss-add-integration"}},c={},u=[{value:"Method and endpoint",id:"method-and-endpoint",level:2},{value:"Example request",id:"example-request",level:2},{value:"Parameters",id:"parameters",level:2},{value:"Successful response: 200: OK",id:"successful-response-200-ok",level:2},{value:"Errors",id:"errors",level:2},{value:"400: Bad request",id:"400-bad-request",level:3}];function h(e){const t={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Validates a purchase using the provided Stripe token using the credentials of Stripe in your App Settings inside Adapty Dashboard. If the purchase is valid, the transaction history is imported from Stripe to the profile in Adapty with the specified ",(0,s.jsx)(t.code,{children:"customer_user_id"}),". If there was no profile with this ",(0,s.jsx)(t.code,{children:"customer_user_id"})," before \u2014 it will be created."]}),"\n",(0,s.jsx)(t.p,{children:"Profile events are generated along the way and imported transactions are counted towards MTR."}),"\n",(0,s.jsx)(t.h2,{id:"method-and-endpoint",children:"Method and endpoint"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-http",children:"POST https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/\n"})}),"\n",(0,s.jsxs)(t.admonition,{type:"warning",children:[(0,s.jsx)(t.p,{children:"This request requires different authorization parameters:"}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Base URL"}),": ",(0,s.jsx)(t.a,{href:"https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/",children:"https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Authorization"}),": API requests must be authenticated by including your secret API key as an ",(0,s.jsx)(t.strong,{children:"Authorization header"})," with value ",(0,s.jsx)(t.code,{children:"Api-Key {secret_token}"})," to each request, for example, ",(0,s.jsx)(t.code,{children:"Api-Key secret_live_..."}),". You can find your secret API key in ",(0,s.jsxs)(t.a,{href:"https://app.adapty.io/settings/general",children:["Adapty Dashboard -> ",(0,s.jsx)(t.strong,{children:"App Settings"})," -> ",(0,s.jsx)(t.strong,{children:"General"})," tab API -> ",(0,s.jsx)(t.strong,{children:"API keys"})," section"]}),". This key is secret, so be careful not to share it publicly."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Content-Type header"}),": The API expects the request to use the ",(0,s.jsx)(t.strong,{children:"Content-Type"})," header set to ",(0,s.jsx)(t.code,{children:"application/vnd.api+json"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Body"}),":  The API expects the request to use the body as JSON."]}),"\n"]})]}),"\n",(0,s.jsx)(t.h2,{id:"example-request",children:"Example request"}),"\n",(0,s.jsxs)(i.A,{groupId:"api-lang",queryString:!0,children:[(0,s.jsx)(a.A,{value:"curl",label:"cURL",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-bash",metastring:"showLineNumbers",children:'curl --location \'https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/\' \\\n--header \'Content-Type: application/vnd.api+json\' \\\n--header \'Authorization: Api-Key <YOUR_SECRET_API_KEY>\' \\\n--data \'{\n  "type": "stripe_receipt_validation_result",\n  "attributes": {\n      "customer_user_id": "<YOUR_CUSTOMER_USER_ID>",\n      "stripe_token": "<YOUR_STRIPE_TOKEN>"\n  }\n}\'\n'})})}),(0,s.jsx)(a.A,{value:"python",label:"Python",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-python",metastring:"showLineNumbers",children:'import requests\n\nurl = "https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/"\n\npayload = {\n    "type": "stripe_receipt_validation_result",\n    "attributes": {\n        "customer_user_id": "<YOUR_CUSTOMER_USER_ID>",\n        "stripe_token": "<YOUR_STRIPE_TOKEN>"\n    }\n}\n\nheaders = {\n    "Content-Type": "application/vnd.api+json",\n    "Authorization": "Api-Key <YOUR_SECRET_API_KEY>"\n}\n\nresponse = requests.post(url, headers=headers, json=payload)\n\nprint(response.text)\n'})})}),(0,s.jsx)(a.A,{value:"js",label:"JavaScript",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:"showLineNumbers",children:'const myHeaders = new Headers();\nmyHeaders.append("Content-Type", "application/vnd.api+json");\nmyHeaders.append("Authorization", "Api-Key <YOUR_SECRET_API_KEY>");\n\nconst raw = JSON.stringify({\n  "type": "stripe_receipt_validation_result",\n  "attributes": {\n    "customer_user_id": "<YOUR_CUSTOMER_USER_ID>",\n    "stripe_token": "<YOUR_STRIPE_TOKEN>"\n  }\n});\n\nconst requestOptions = {\n  method: "POST",\n  headers: myHeaders,\n  body: raw,\n  redirect: "follow"\n};\n\nfetch("https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/", requestOptions)\n  .then((response) => response.text())\n  .then((result) => console.log(result))\n  .catch((error) => console.error(error));\n'})})})]}),"\n",(0,s.jsx)(t.p,{children:"Placeholders:"}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.code,{children:"<YOUR_SECRET_API_KEY>"}),": Your secret API key for authorization."]}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"parameters",children:"Parameters"}),"\n",(0,s.jsxs)(t.admonition,{type:"warning",children:[(0,s.jsx)(t.p,{children:"This request requires different authorization parameters:"}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Base URL"}),": ",(0,s.jsx)(t.a,{href:"https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/",children:"https://api.adapty.io/api/v1/sdk/purchase/stripe/token/validate/"})]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Authorization"}),": API requests must be authenticated by including your secret API key as an ",(0,s.jsx)(t.strong,{children:"Authorization header"})," with value ",(0,s.jsx)(t.code,{children:"Api-Key {secret_token}"})," to each request, for example, ",(0,s.jsx)(t.code,{children:"Api-Key secret_live_..."}),". You can find your secret API key in ",(0,s.jsxs)(t.a,{href:"https://app.adapty.io/settings/general",children:["Adapty Dashboard -> ",(0,s.jsx)(t.strong,{children:"App Settings"})," -> ",(0,s.jsx)(t.strong,{children:"General"})," tab API -> ",(0,s.jsx)(t.strong,{children:"API keys"})," section"]}),". This key is secret, so be careful not to share it publicly."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Content-Type header"}),": The API expects the request to use the ",(0,s.jsx)(t.strong,{children:"Content-Type"})," header set to ",(0,s.jsx)(t.code,{children:"application/vnd.api+json"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Body"}),":  The API expects the request to use the body as JSON."]}),"\n"]})]}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Parameters"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Type"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Required"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Nullable"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"customer_user_id"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u2795"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u2796"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["The ID of your user in your system. You can see it in the ",(0,s.jsx)(t.strong,{children:"Customer user ID"})," field on the Adapty Dashboard -> ",(0,s.jsx)(t.a,{href:"https://app.adapty.io/profiles/users",children:(0,s.jsx)(t.strong,{children:"Profiles"})})," -> specific profile page. For it to work, you must ",(0,s.jsx)(t.a,{href:"identifying-users",children:"identify the users"})," in your mobile app code via Adapty SDK."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"stripe_token"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"String"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u2795"}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"\u2796"}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Token of a Stripe object that represents a unique purchase. Could either be a token of Stripe's Subscription (",(0,s.jsx)(t.code,{children:"sub_XXX"}),") or Payment Intent (",(0,s.jsx)(t.code,{children:"pi_XXX"}),")."]})]})]})]}),"\n",(0,s.jsx)(t.h2,{id:"successful-response-200-ok",children:"Successful response: 200: OK"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",metastring:"showLineNumbers",children:'{\n  "data": null\n}\n'})}),"\n",(0,s.jsx)(t.h2,{id:"errors",children:"Errors"}),"\n",(0,s.jsx)(t.h3,{id:"400-bad-request",children:"400: Bad request"}),"\n",(0,s.jsx)(t.p,{children:"Contain a list of errors with parameters."}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Parameters"})}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Parameter"}),(0,s.jsx)(t.th,{children:"Type"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"detail"}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsx)(t.td,{children:"Descriptive information about the error."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"source"}),(0,s.jsx)(t.td,{children:"String"}),(0,s.jsxs)(t.td,{children:["An object containing a ",(0,s.jsx)(t.code,{children:'"pointer"'})," that references the exact location in the request document causing the issue."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Status"}),(0,s.jsx)(t.td,{children:"Integer"}),(0,s.jsxs)(t.td,{children:["HTTP status. Always ",(0,s.jsx)(t.code,{children:"400."})]})]})]})]}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"Response example"})}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",metastring:"showLineNumbers",children:'{\n  "errors": [\n    {\n      "detail": "none is not an allowed value",\n      "source": {\n        "pointer": "/data/attributes/stripe_token"\n      },\n      "status": "400"\n    }\n  ]\n}\n'})}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"See also:"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"ss-grant-access-level",children:"Grant access level"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"ss-revoke-access-level",children:"Revoke access level"})}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"ss-set-transaction",children:"Set transaction"})}),"\n"]})]})}function p(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(h,{...e})}):h(e)}}}]);