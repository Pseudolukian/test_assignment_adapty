"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[7477],{11470:(e,t,r)=>{r.d(t,{A:()=>A});var s=r(96540),n=r(34164),a=r(23104),i=r(56347),l=r(205),o=r(57485),c=r(31682),u=r(70679);function d(e){return s.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,s.isValidElement)(e)&&function(e){const{props:t}=e;return!!t&&"object"==typeof t&&"value"in t}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function h(e){const{values:t,children:r}=e;return(0,s.useMemo)((()=>{const e=t??function(e){return d(e).map((e=>{let{props:{value:t,label:r,attributes:s,default:n}}=e;return{value:t,label:r,attributes:s,default:n}}))}(r);return function(e){const t=(0,c.X)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,r])}function p(e){let{value:t,tabValues:r}=e;return r.some((e=>e.value===t))}function f(e){let{queryString:t=!1,groupId:r}=e;const n=(0,i.W6)(),a=function(e){let{queryString:t=!1,groupId:r}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!r)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return r??null}({queryString:t,groupId:r});return[(0,o.aZ)(a),(0,s.useCallback)((e=>{if(!a)return;const t=new URLSearchParams(n.location.search);t.set(a,e),n.replace({...n.location,search:t.toString()})}),[a,n])]}function m(e){const{defaultValue:t,queryString:r=!1,groupId:n}=e,a=h(e),[i,o]=(0,s.useState)((()=>function(e){let{defaultValue:t,tabValues:r}=e;if(0===r.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:r}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${r.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const s=r.find((e=>e.default))??r[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:t,tabValues:a}))),[c,d]=f({queryString:r,groupId:n}),[m,v]=function(e){let{groupId:t}=e;const r=function(e){return e?`docusaurus.tab.${e}`:null}(t),[n,a]=(0,u.Dv)(r);return[n,(0,s.useCallback)((e=>{r&&a.set(e)}),[r,a])]}({groupId:n}),g=(()=>{const e=c??m;return p({value:e,tabValues:a})?e:null})();(0,l.A)((()=>{g&&o(g)}),[g]);return{selectedValue:i,selectValue:(0,s.useCallback)((e=>{if(!p({value:e,tabValues:a}))throw new Error(`Can't select invalid tab value=${e}`);o(e),d(e),v(e)}),[d,v,a]),tabValues:a}}var v=r(92303);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};var b=r(74848);function y(e){let{className:t,block:r,selectedValue:s,selectValue:i,tabValues:l}=e;const o=[],{blockElementScrollPositionUntilNextRender:c}=(0,a.a_)(),u=e=>{const t=e.currentTarget,r=o.indexOf(t),n=l[r].value;n!==s&&(c(t),i(n))},d=e=>{let t=null;switch(e.key){case"Enter":u(e);break;case"ArrowRight":{const r=o.indexOf(e.currentTarget)+1;t=o[r]??o[0];break}case"ArrowLeft":{const r=o.indexOf(e.currentTarget)-1;t=o[r]??o[o.length-1];break}}t?.focus()};return(0,b.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,n.A)("tabs",{"tabs--block":r},t),children:l.map((e=>{let{value:t,label:r,attributes:a}=e;return(0,b.jsx)("li",{role:"tab",tabIndex:s===t?0:-1,"aria-selected":s===t,ref:e=>o.push(e),onKeyDown:d,onClick:u,...a,className:(0,n.A)("tabs__item",g.tabItem,a?.className,{"tabs__item--active":s===t}),children:r??t},t)}))})}function j(e){let{lazy:t,children:r,selectedValue:n}=e;const a=(Array.isArray(r)?r:[r]).filter(Boolean);if(t){const e=a.find((e=>e.props.value===n));return e?(0,s.cloneElement)(e,{className:"margin-top--md"}):null}return(0,b.jsx)("div",{className:"margin-top--md",children:a.map(((e,t)=>(0,s.cloneElement)(e,{key:t,hidden:e.props.value!==n})))})}function x(e){const t=m(e);return(0,b.jsxs)("div",{className:(0,n.A)("tabs-container",g.tabList),children:[(0,b.jsx)(y,{...t,...e}),(0,b.jsx)(j,{...t,...e})]})}function A(e){const t=(0,v.A)();return(0,b.jsx)(x,{...e,children:d(e.children)},String(t))}},19365:(e,t,r)=>{r.d(t,{A:()=>i});r(96540);var s=r(34164);const n={tabItem:"tabItem_Ymn6"};var a=r(74848);function i(e){let{children:t,hidden:r,className:i}=e;return(0,a.jsx)("div",{role:"tabpanel",className:(0,s.A)(n.tabItem,i),hidden:r,children:t})}},45322:(e,t,r)=>{r.d(t,{A:()=>n});r(96540);var s=r(74848);const n=e=>{let{children:t,...r}=e;return(0,s.jsx)("details",{...r,children:t})}},90316:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>h,contentTitle:()=>u,default:()=>m,frontMatter:()=>c,metadata:()=>d,toc:()=>p});var s=r(74848),n=r(28453),a=(r(26393),r(11470)),i=r(19365),l=r(45322),o=r(97808);const c={title:"Check subscription status",description:"Track and manage user subscription status in Adapty for improved customer retention.",metadataTitle:"Understanding Subscription Status | Adapty Docs"},u=void 0,d={id:"subscription-status",title:"Check subscription status",description:"Track and manage user subscription status in Adapty for improved customer retention.",source:"@site/versioned_docs/version-3.0/subscription-status.md",sourceDirName:".",slug:"/subscription-status",permalink:"/docs/subscription-status",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"Check subscription status",description:"Track and manage user subscription status in Adapty for improved customer retention.",metadataTitle:"Understanding Subscription Status | Adapty Docs"},sidebar:"tutorialSidebar",previous:{title:"Restore purchases in mobile app",permalink:"/docs/restore-purchase"},next:{title:"Identify users",permalink:"/docs/identifying-users"}},h={},p=[{value:"Access level and the AdaptyProfile object",id:"access-level-and-the-adaptyprofile-object",level:2},...o.RM,{value:"Retrieving the access level from the server",id:"retrieving-the-access-level-from-the-server",level:2},{value:"Listening for subscription status updates",id:"listening-for-subscription-status-updates",level:3},{value:"Subscription status cache",id:"subscription-status-cache",level:3}];function f(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,n.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["With Adapty, keeping track of subscription status is made easy. You don't have to manually insert product IDs into your code. Instead, you can effortlessly confirm a user's subscription status by checking for an active ",(0,s.jsx)(t.a,{href:"access-level",children:"access level"}),"."]}),"\n",(0,s.jsxs)(l.A,{children:[(0,s.jsx)("summary",{children:"Before you start checking subscription status (Click to Expand)"}),(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:["For iOS, set up ",(0,s.jsx)(t.a,{href:"enable-app-store-server-notifications",children:"App Store Server Notifications"})]}),"\n",(0,s.jsxs)(t.li,{children:["For Android, set up ",(0,s.jsx)(t.a,{href:"enable-real-time-developer-notifications-rtdn",children:"Real-time Developer Notifications (RTDN)"})]}),"\n"]})]}),"\n",(0,s.jsx)(t.h2,{id:"access-level-and-the-adaptyprofile-object",children:"Access level and the AdaptyProfile object"}),"\n",(0,s.jsxs)(t.p,{children:["Access levels are properties of the ",(0,s.jsx)(t.a,{href:"sdk-models#adaptyprofile",children:"AdaptyProfile"})," object. We recommend retrieving the profile when your app starts, such as when you ",(0,s.jsx)(t.a,{href:"identifying-users#setting-customer-user-id-on-configuration",children:"identify a user"})," , and then updating it whenever changes occur. This way, you can use the profile object without repeatedly requesting it."]}),"\n",(0,s.jsxs)(t.p,{children:["To be notified of profile updates, listen for profile changes as described in the ",(0,s.jsx)(t.a,{href:"subscription-status#listening-for-subscription-status-updates",children:"Listening for profile updates, including access levels"})," section below."]}),"\n",(0,s.jsx)(o.Ay,{}),"\n",(0,s.jsx)(t.h2,{id:"retrieving-the-access-level-from-the-server",children:"Retrieving the access level from the server"}),"\n",(0,s.jsxs)(t.p,{children:["To get the access level from the server, use the ",(0,s.jsx)(t.code,{children:".getProfile()"})," method:"]}),"\n",(0,s.jsxs)(a.A,{groupId:"current-os",queryString:!0,children:[(0,s.jsx)(i.A,{value:"swift",label:"Swift",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:"showLineNumbers",children:'do {\n    let profile = try await Adapty.getProfile()\n    \n    if profile.accessLevels["YOUR_ACCESS_LEVEL"]?.isActive ?? false {\n        // grant access to premium features\n    }\n} catch {\n    // handle the error\n}\n'})})}),(0,s.jsx)(i.A,{value:"swift-callback",label:"Swift-Callback",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:"showLineNumbers",children:'Adapty.getProfile { result in\n    if let profile = try? result.get() {\n        // check the access\n        profile.accessLevels["YOUR_ACCESS_LEVEL"]?.isActive ?? false {\n            // grant access to premium features\n        }\n    }\n}\n'})})}),(0,s.jsx)(i.A,{value:"kotlin",label:"Kotlin",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kotlin",metastring:"showLineNumbers",children:"Adapty.getProfile { result ->\n    when (result) {\n        is AdaptyResult.Success -> {\n            val profile = result.value\n            // check the access\n        }\n        is AdaptyResult.Error -> {\n            val error = result.error\n            // handle the error\n        }\n    }\n}\n"})})}),(0,s.jsx)(i.A,{value:"java",label:"Java",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:"showLineNumbers",children:"Adapty.getProfile(result -> {\n    if (result instanceof AdaptyResult.Success) {\n        AdaptyProfile profile = ((AdaptyResult.Success<AdaptyProfile>) result).getValue();\n        // check the access\n      \n    } else if (result instanceof AdaptyResult.Error) {\n        AdaptyError error = ((AdaptyResult.Error) result).getError();\n        // handle the error\n    }\n});\n"})})}),(0,s.jsx)(i.A,{value:"flutter",label:"Flutter",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:"showLineNumbers",children:"try {\n  final profile = await Adapty().getProfile();\n  // check the access\n} on AdaptyError catch (adaptyError) {\n  // handle the error\n} catch (e) {\n}\n"})})}),(0,s.jsx)(i.A,{value:"unity",label:"Unity",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",metastring:"showLineNumbers",children:"Adapty.GetProfile((profile, error) => {\n  if (error != null) {\n    // handle the error\n    return;\n  }\n  \n  // check the access\n});\n"})})}),(0,s.jsx)(i.A,{value:"rn",label:"React Native (TS)",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",metastring:"showLineNumbers",children:"try {\n    const profile = await adapty.getProfile();\n} catch (error) {\n  // handle the error\n}\n"})})})]}),"\n",(0,s.jsx)(t.p,{children:"Response parameters:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Parameter"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsx)(t.tbody,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:"Profile"}),(0,s.jsxs)(t.td,{children:[(0,s.jsxs)("p",{children:["An ",(0,s.jsx)(t.a,{href:"sdk-models#adaptyprofile",children:"AdaptyProfile"})," object. Generally, you have to check only the access level status of the profile to determine whether the user has premium access to the app."]}),(0,s.jsx)("p",{}),(0,s.jsxs)("p",{children:["The ",(0,s.jsx)(t.code,{children:".getProfile"})," method provides the most up-to-date result as it always tries to query the API. If for some reason (e.g. no internet connection), the Adapty SDK fails to retrieve information from the server, the data from the cache will be returned. It is also important to note that the Adapty SDK updates ",(0,s.jsx)(t.code,{children:"AdaptyProfile"})," cache regularly, to keep this information as up-to-date as possible."]})]})]})})]}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:".getProfile()"}),' method provides you with the user profile from which you can get the access level status. You can have multiple access levels per app. For example, if you have a newspaper app and sell subscriptions to different topics independently, you can create access levels "sports" and "science". But most of the time, you will only need one access level, in that case, you can just use the default "premium" access level.']}),"\n",(0,s.jsx)(t.p,{children:'Here is an example for checking for the default "premium" access level:'}),"\n",(0,s.jsxs)(a.A,{groupId:"current-os",queryString:!0,children:[(0,s.jsx)(i.A,{value:"swift",label:"Swift",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:"showLineNumbers",children:'do {\n    let profile = try await Adapty.getProfile()\n    let isPremium = profile.accessLevels["premium"]?.isActive ?? false\n    // grant access to premium features\n} catch {\n    // handle the error\n}\n'})})}),(0,s.jsx)(i.A,{value:"swift-callback",label:"Swift-Callback",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:"showLineNumbers",children:'Adapty.getProfile { result in\n    if let profile = try? result.get(), \n       profile.accessLevels["premium"]?.isActive ?? false {\n        // grant access to premium features\n    }\n}\n'})})}),(0,s.jsx)(i.A,{value:"kotlin",label:"Kotlin",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kotlin",metastring:"showLineNumbers",children:'Adapty.getProfile { result ->\n    when (result) {\n        is AdaptyResult.Success -> {\n            val profile = result.value\n            \n            if (profile.accessLevels["premium"]?.isActive == true) {\n                // grant access to premium features\n            }\n        }\n        is AdaptyResult.Error -> {\n            val error = result.error\n            // handle the error\n        }\n    }\n}\n'})})}),(0,s.jsx)(i.A,{value:"java",label:"Java",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:"showLineNumbers",children:'Adapty.getProfile(result -> {\n    if (result instanceof AdaptyResult.Success) {\n        AdaptyProfile profile = ((AdaptyResult.Success<AdaptyProfile>) result).getValue();\n        \n        AdaptyProfile.AccessLevel premium = profile.getAccessLevels().get("premium");\n        \n        if (premium != null && premium.isActive()) {\n            // grant access to premium features\n        }\n    } else if (result instanceof AdaptyResult.Error) {\n        AdaptyError error = ((AdaptyResult.Error) result).getError();\n        // handle the error\n    }\n});\n'})})}),(0,s.jsx)(i.A,{value:"flutter",label:"Flutter",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:"showLineNumbers",children:"try {\n  final profile = await Adapty().getProfile();\n  if (profile?.accessLevels['premium']?.isActive ?? false) {\n        // grant access to premium features\n    }\n} on AdaptyError catch (adaptyError) {\n  // handle the error\n} catch (e) {\n}\n"})})}),(0,s.jsx)(i.A,{value:"unity",label:"Unity",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",metastring:"showLineNumbers",children:'Adapty.GetProfile((profile, error) => {\n  if (error != null) {\n    // handle the error\n    return;\n  }\n\n  // "premium" is an identifier of default access level\n  var accessLevel = profile.AccessLevels["premium"];\n  if (accessLevel != null && accessLevel.IsActive) {\n    // grant access to premium features\n  }\n});\n'})})}),(0,s.jsx)(i.A,{value:"rn",label:"React Native (TS)",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",metastring:"showLineNumbers",children:'try {\n    const profile = await adapty.getProfile();\n    \n  const isActive = profile.accessLevels["premium"]?.isActive;\n    if (isActive) {\n        // grant access to premium features\n    }\n} catch (error) {\n    // handle the error\n}\n'})})})]}),"\n",(0,s.jsx)(t.h3,{id:"listening-for-subscription-status-updates",children:"Listening for subscription status updates"}),"\n",(0,s.jsx)(t.p,{children:"Whenever the user's subscription changes, Adapty fires an event."}),"\n",(0,s.jsx)(t.p,{children:"To receive messages from Adapty, you need to make some additional configuration:"}),"\n",(0,s.jsxs)(a.A,{groupId:"current-os",queryString:!0,children:[(0,s.jsx)(i.A,{value:"swift",label:"Swift",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:"showLineNumbers",children:"Adapty.delegate = self\n\n// To receive subscription updates, extend `AdaptyDelegate` with this method:\nnonisolated func didLoadLatestProfile(_ profile: AdaptyProfile) {\n    // handle any changes to subscription state\n}\n"})})}),(0,s.jsx)(i.A,{value:"kotlin",label:"Kotlin",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-kotlin",metastring:"showLineNumbers",children:"Adapty.setOnProfileUpdatedListener { profile ->\n    // handle any changes to subscription state\n}\n"})})}),(0,s.jsx)(i.A,{value:"java",label:"Java",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-java",metastring:"showLineNumbers t",children:"Adapty.setOnProfileUpdatedListener(profile -> {\n    // handle any changes to subscription state\n});\n"})})}),(0,s.jsx)(i.A,{value:"flutter",label:"Flutter",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-javascript",metastring:"showLineNumbers",children:"Adapty().didUpdateProfileStream.listen((profile) {\n  // handle any changes to subscription state\n});\n"})})}),(0,s.jsx)(i.A,{value:"unity",label:"Unity",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-csharp",metastring:"showLineNumbers",children:"// Extend `AdaptyEventListener ` with `OnLoadLatestProfile ` method:\npublic class AdaptyListener : MonoBehaviour, AdaptyEventListener {\n  public void OnLoadLatestProfile(AdaptyProfile profile) {\n    // handle any changes to subscription state\n  }\n}\n"})})}),(0,s.jsx)(i.A,{value:"rn",label:"React Native (TS)",default:!0,children:(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-typescript",metastring:"showLineNumbers",children:"// Create an \"onLatestProfileLoad\" event listener\nadapty.addEventListener('onLatestProfileLoad', profile => {\n    // handle any changes to subscription state\n});\n"})})})]}),"\n",(0,s.jsx)(t.p,{children:"Adapty also fires an event at the start of the application. In this case, the cached subscription status will be passed."}),"\n",(0,s.jsx)(t.h3,{id:"subscription-status-cache",children:"Subscription status cache"}),"\n",(0,s.jsx)(t.p,{children:"The cache implemented in the Adapty SDK stores the subscription status of the profile. This means that even if the server is unavailable, the cached data can be accessed to provide information about the profile's subscription status."}),"\n",(0,s.jsx)(t.p,{children:"However, it's important to note that direct data requests from the cache are not possible. The SDK periodically queries the server every minute to check for any updates or changes related to the profile. If there are any modifications, such as new transactions or other updates, they will be sent to the cached data in order to keep it synchronized with the server."})]})}function m(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(f,{...e})}):f(e)}},97808:(e,t,r)=>{r.d(t,{Ay:()=>l,RM:()=>a});var s=r(74848),n=r(28453);const a=[];function i(e){const t={a:"a",admonition:"admonition",p:"p",...(0,n.R)(),...e.components};return(0,s.jsx)(t.admonition,{type:"tip",children:(0,s.jsxs)(t.p,{children:["Want to see a real-world example of how Adapty SDK is integrated into a mobile app? Check out our ",(0,s.jsx)(t.a,{href:"sample-apps",children:"sample apps"}),", which demonstrate the full setup, including displaying paywalls, making purchases, and other basic functionality."]})})}function l(e={}){const{wrapper:t}={...(0,n.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(i,{...e})}):i(e)}}}]);