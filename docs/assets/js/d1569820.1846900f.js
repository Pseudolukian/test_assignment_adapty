"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[1466],{34735:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>i,default:()=>h,frontMatter:()=>s,metadata:()=>a,toc:()=>o});var r=n(74848),l=n(28453);const s={title:"iOS - Handle paywall events",description:"Handle events in iOS (Legacy) apps with Adapty\u2019s event tracking system.",metadataTitle:"Handling Events in iOS (Legacy) | Adapty Docs",toc_max_heading_level:4},i=void 0,a={id:"ios-handling-events-legacy",title:"iOS - Handle paywall events",description:"Handle events in iOS (Legacy) apps with Adapty\u2019s event tracking system.",source:"@site/versioned_docs/version-3.0/ios-handling-events-legacy.md",sourceDirName:".",slug:"/ios-handling-events-legacy",permalink:"/docs/ios-handling-events-legacy",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"iOS - Handle paywall events",description:"Handle events in iOS (Legacy) apps with Adapty\u2019s event tracking system.",metadataTitle:"Handling Events in iOS (Legacy) | Adapty Docs",toc_max_heading_level:4},sidebar:"tutorialSidebar",previous:{title:"Handle legacy Paywall Builder paywall events",permalink:"/docs/handling-legacy-pb-paywall-events"},next:{title:"Android",permalink:"/docs/android-handling-events-legacy"}},d={},o=[{value:"Handling events in Swift",id:"handling-events-in-swift",level:2},{value:"User-generated events",id:"user-generated-events",level:3},{value:"Actions",id:"actions",level:4},{value:"Product selection",id:"product-selection",level:4},{value:"Started purchase",id:"started-purchase",level:4},{value:"Canceled purchase",id:"canceled-purchase",level:4},{value:"Successful purchase",id:"successful-purchase",level:4},{value:"Failed purchase",id:"failed-purchase",level:4},{value:"Successful restore",id:"successful-restore",level:4},{value:"Failed restore",id:"failed-restore",level:4},{value:"Data fetching and rendering",id:"data-fetching-and-rendering",level:3},{value:"Product loading errors",id:"product-loading-errors",level:4},{value:"Rendering errors",id:"rendering-errors",level:4},{value:"Handling events in SwiftUI",id:"handling-events-in-swiftui",level:2}];function c(e){const t={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(t.p,{children:["Paywalls configured with the ",(0,r.jsx)(t.a,{href:"adapty-paywall-builder-legacy",children:"Paywall Builder"})," don't need extra code to make and restore purchases. However, they generate some events that your app can respond to. Those events include button presses (close buttons, URLs, product selections, and so on) as well as notifications on purchase-related actions taken on the paywall. Learn how to respond to these events below."]}),"\n",(0,r.jsx)(t.admonition,{type:"warning",children:(0,r.jsxs)(t.p,{children:["This guide is for ",(0,r.jsx)(t.strong,{children:"legacy Paywall Builder paywalls"})," only which require Adapty SDK up to v2.x. For presenting paywalls in Adapty SDK v3.0 or later designed with new Paywall Builder, see ",(0,r.jsx)(t.a,{href:"ios-handling-events",children:"iOS - Handle paywall events designed with new Paywall Builder"}),"."]})}),"\n",(0,r.jsx)(t.h2,{id:"handling-events-in-swift",children:"Handling events in Swift"}),"\n",(0,r.jsxs)(t.p,{children:["To control or monitor processes occurring on the paywall screen within your mobile app, implement the ",(0,r.jsx)(t.code,{children:"AdaptyPaywallControllerDelegate"})," methods."]}),"\n",(0,r.jsx)(t.h3,{id:"user-generated-events",children:"User-generated events"}),"\n",(0,r.jsx)(t.h4,{id:"actions",children:"Actions"}),"\n",(0,r.jsxs)(t.p,{children:["If a user performs some action (",(0,r.jsx)(t.code,{children:"close"}),", ",(0,r.jsx)(t.code,{children:"openURL(url:)"})," or ",(0,r.jsx)(t.code,{children:"custom(id:)"}),"), the method below will be invoked. Note that this is just an example and you can implement the response to actions differently:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'func paywallController(_ controller: AdaptyPaywallController,\n                       didPerform action: AdaptyUI.Action) {\n\n    switch action {\n        case .close:\n            controller.dismiss(animated: true)\n        case let .openURL(url):\n      \t\t\t// handle URL opens (incl. terms and privacy links)\n            UIApplication.shared.open(url, options: [:])\n        case let .custom(id):\n            if id == "login" {\n               // implement login flow \n            }\n            break\n    }\n}\n'})}),"\n",(0,r.jsxs)(t.p,{children:["For example, if a user taps the close button, the action ",(0,r.jsx)(t.code,{children:"close"})," will occur and you are supposed to dismiss the paywall. Note that at the very least you need to implement the reactions to both ",(0,r.jsx)(t.code,{children:"close"})," and ",(0,r.jsx)(t.code,{children:"openURL"}),"."]}),"\n",(0,r.jsxs)(t.blockquote,{children:["\n",(0,r.jsx)(t.p,{children:"\ud83d\udca1 Login Action"}),"\n",(0,r.jsxs)(t.p,{children:["If you have configured Login Action in the dashboard, you should also implement reaction for custom action with id ",(0,r.jsx)(t.code,{children:'"login"'}),"."]}),"\n"]}),"\n",(0,r.jsx)(t.h4,{id:"product-selection",children:"Product selection"}),"\n",(0,r.jsx)(t.p,{children:"If a user selects a product for purchase, this method will be invoked:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"    func paywallController(_ controller: AdaptyPaywallController,\n                           didSelectProduct product: AdaptyPaywallProduct) {\n    }\n"})}),"\n",(0,r.jsx)(t.h4,{id:"started-purchase",children:"Started purchase"}),"\n",(0,r.jsx)(t.p,{children:"If a user initiates the purchase process, this method will be invoked:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(_ controller: AdaptyPaywallController,\n                       didStartPurchase product: AdaptyPaywallProduct) {\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(t.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,r.jsx)(t.h4,{id:"canceled-purchase",children:"Canceled purchase"}),"\n",(0,r.jsxs)(t.p,{children:["If a user initiates the purchase process but manually interrupts it, the method below will be invoked. This event occurs when the ",(0,r.jsx)(t.code,{children:"Adapty.makePurchase()"})," function completes with a ",(0,r.jsx)(t.code,{children:".paymentCancelled"})," error:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(_ controller: AdaptyPaywallController,\n                       didCancelPurchase product: AdaptyPaywallProduct) {\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(t.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"}),"  topic for details."]}),"\n",(0,r.jsx)(t.h4,{id:"successful-purchase",children:"Successful purchase"}),"\n",(0,r.jsxs)(t.p,{children:["If ",(0,r.jsx)(t.code,{children:"Adapty.makePurchase()"})," succeeds, this method will be invoked:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(_ controller: AdaptyPaywallController,\n                       didFinishPurchase product: AdaptyPaywallProduct,\n                       purchasedInfo: AdaptyPurchasedInfo) {      \n    controller.dismiss(animated: true)\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"We recommend dismissing the paywall screen in that case."}),"\n",(0,r.jsxs)(t.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(t.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,r.jsx)(t.h4,{id:"failed-purchase",children:"Failed purchase"}),"\n",(0,r.jsxs)(t.p,{children:["If ",(0,r.jsx)(t.code,{children:"Adapty.makePurchase()"})," fails, this method will be invoked:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(_ controller: AdaptyPaywallController,\n                       didFailPurchase product: AdaptyPaywallProduct,\n                       error: AdaptyError) {\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(t.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,r.jsx)(t.h4,{id:"successful-restore",children:"Successful restore"}),"\n",(0,r.jsxs)(t.p,{children:["If ",(0,r.jsx)(t.code,{children:"Adapty.restorePurchases()"})," succeeds, this method will be invoked:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(_ controller: AdaptyPaywallController, \n                       didFinishRestoreWith profile: AdaptyProfile) {\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["We recommend dismissing the screen if a the has the required ",(0,r.jsx)(t.code,{children:"accessLevel"}),". Refer to the ",(0,r.jsx)(t.a,{href:"subscription-status",children:"Subscription status"})," topic to learn how to check it."]}),"\n",(0,r.jsx)(t.h4,{id:"failed-restore",children:"Failed restore"}),"\n",(0,r.jsxs)(t.p,{children:["If ",(0,r.jsx)(t.code,{children:"Adapty.restorePurchases()"})," fails, this method will be invoked:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"public func paywallController(_ controller: AdaptyPaywallController, \n                              didFailRestoreWith error: AdaptyError) {\n}\n"})}),"\n",(0,r.jsx)(t.h3,{id:"data-fetching-and-rendering",children:"Data fetching and rendering"}),"\n",(0,r.jsx)(t.h4,{id:"product-loading-errors",children:"Product loading errors"}),"\n",(0,r.jsx)(t.p,{children:"If you don't pass the product array during the initialization, AdaptyUI will retrieve the necessary objects from the server by itself. If this operation fails, AdaptyUI will report the error by calling this method:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"public func paywallController(_ controller: AdaptyPaywallController,\n                              didFailLoadingProductsWith error: AdaptyError) -> Bool {\n    return true\n}\n"})}),"\n",(0,r.jsxs)(t.p,{children:["If you return ",(0,r.jsx)(t.code,{children:"true"}),", AdaptyUI will repeat the request after 2 seconds."]}),"\n",(0,r.jsx)(t.h4,{id:"rendering-errors",children:"Rendering errors"}),"\n",(0,r.jsx)(t.p,{children:"If an error occurs during the interface rendering, it will be reported by this method:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"public func paywallController(_ controller: AdaptyPaywallController,\n                              didFailRenderingWith error: AdaptyError) {\n}\n"})}),"\n",(0,r.jsx)(t.p,{children:"In a normal situation, such errors should not occur, so if you come across one, please let us know."}),"\n",(0,r.jsx)(t.h2,{id:"handling-events-in-swiftui",children:"Handling events in SwiftUI"}),"\n",(0,r.jsxs)(t.p,{children:["To control or monitor processes occurring on the paywall screen within your mobile app, use the ",(0,r.jsx)(t.code,{children:".paywall"})," modifier in SwiftUI:"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'@State var paywallPresented = false\n\nvar body: some View {\n\tText("Hello, AdaptyUI!")\n\t\t\t.paywall(\n          isPresented: $paywallPresented,\n          paywall: paywall,\n          configuration: viewConfig,\n          didPerformAction: { action in\n              switch action {\n                  case .close:\n                      paywallPresented = false\n                \tcase .openURL(url):\n                \t\t\t// handle opening the URL (incl. for terms and privacy)\n                \tcase \n                  default:\n                      // handle other actions\n                      break\n              }\n          },\n          didSelectProduct: { /* Handle the event */  },\n          didStartPurchase: { /* Handle the event */ },\n          didFinishPurchase: { product, info in /* Handle the event */ },\n          didFailPurchase: { product, error in /* Handle the event */ },\n          didCancelPurchase: { /* Handle the event */ },\n          didStartRestore: { /* Handle the event */ },\n          didFinishRestore: { /* Handle the event */ },\n          didFailRestore: { /* Handle the event */ },\n          didFailRendering: { error in\n              paywallPresented = false\n          },\n          didFailLoadingProducts: { error in\n              return false\n          }\n      )\n}\n'})}),"\n",(0,r.jsx)(t.p,{children:"You can register only the closure parameters you need, and omit those you do not need. In this case, unused closure parameters will not be created."}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Closure parameter"}),(0,r.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didSelectProduct"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If a user selects a product for purchase, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didStartPurchase"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If a user initiates the purchase process, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didFinishPurchase"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If Adapty.makePurchase() succeeds, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didFailPurchase"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If Adapty.makePurchase() fails, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didCancelPurchase"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If a user initiates the purchase process but manually interrupts it, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didStartRestore"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If a user initiates the purchase restoration, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didFinishRestore"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["If ",(0,r.jsx)(t.code,{children:"Adapty.restorePurchases()"})," succeeds, this parameter will be invoked."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didFailRestore"})}),(0,r.jsxs)(t.td,{style:{textAlign:"left"},children:["If ",(0,r.jsx)(t.code,{children:"Adapty.restorePurchases()"})," fails, this parameter will be invoked."]})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didFailRendering"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If an error occurs during the interface rendering, this parameter will be invoked."})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{style:{textAlign:"left"},children:(0,r.jsx)(t.strong,{children:"didFailLoadingProducts"})}),(0,r.jsx)(t.td,{style:{textAlign:"left"},children:"If you don't pass the product array during the initialization, AdaptyUI will retrieve the necessary objects from the server by itself. If this operation fails, AdaptyUI will invoke this parameter."})]})]})]}),"\n",(0,r.jsxs)(t.p,{children:["Note that at the very least you need to implement the reactions to both ",(0,r.jsx)(t.code,{children:"close"})," and ",(0,r.jsx)(t.code,{children:"openURL"}),"."]})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}}}]);