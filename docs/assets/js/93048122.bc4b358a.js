"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[4566],{11929:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>r,metadata:()=>l,toc:()=>c});var s=n(74848),i=n(28453);n(26393);const r={title:"iOS \u2013 What's new",description:"Migrate to iOS 2 seamlessly with Adapty\u2019s migration guide.",metadataTitle:"Migrating to iOS 2 | Adapty Docs"},a=void 0,l={id:"migration-to-ios-2",title:"iOS \u2013 What's new",description:"Migrate to iOS 2 seamlessly with Adapty\u2019s migration guide.",source:"@site/versioned_docs/version-3.0/migration-to-ios-2.md",sourceDirName:".",slug:"/migration-to-ios-2",permalink:"/test_assignment_adapty/docs/migration-to-ios-2",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"iOS \u2013 What's new",description:"Migrate to iOS 2 seamlessly with Adapty\u2019s migration guide.",metadataTitle:"Migrating to iOS 2 | Adapty Docs"}},o={},c=[{value:"Profile",id:"profile",level:3},{value:"Paywalls",id:"paywalls",level:3},{value:"Products",id:"products",level:3},{value:"Fallback paywalls",id:"fallback-paywalls",level:3},{value:"Promotional offers",id:"promotional-offers",level:3},{value:"Introductory offer eligibility",id:"introductory-offer-eligibility",level:3},{value:"Products fetch policy",id:"products-fetch-policy",level:3},{value:"Logging",id:"logging",level:3},{value:"iOS and Swift",id:"ios-and-swift",level:3},{value:"In lieu of a conclusion",id:"in-lieu-of-a-conclusion",level:3}];function d(e){const t={a:"a",admonition:"admonition",br:"br",code:"code",em:"em",h3:"h3",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(t.p,{children:"In the new version of the Adapty SDK, we've made quite a lot of changes to the internal implementation of our SDK, applying all of our accumulated experience. We also redesigned our public API and relationships between some entities so that it causes as little misunderstanding as possible and reduces the number of errors made by developers."}),"\n",(0,s.jsx)(t.p,{children:"First, let's look at the main things that have been changed, and then let's discuss each item individually."}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#profile",children:"Profile"})," \u2013 we have renamed ",(0,s.jsx)(t.code,{children:"PurchaserInfo"})," to ",(0,s.jsx)(t.code,{children:"AdaptyProfile"}),". This also affected all related functions."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#paywalls",children:"Paywalls"})," \u2013 now you can get only the necessary paywall."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#products",children:"Products"})," \u2013 we separated the concept of paywall and product, so now the developer first asks for the paywall they want, and then the corresponding product array."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#fallback-paywalls",children:"Fallback Paywalls"})," \u2013 ",(0,s.jsx)(t.code,{children:".setFallbackPaywalls"})," method now accepts ",(0,s.jsx)(t.code,{children:"Data"})," type as a parameter."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#promotional-offers",children:"Promotional offers"})," \u2013 we removed the ",(0,s.jsx)(t.code,{children:"offerId"})," parameter from ",(0,s.jsx)(t.code,{children:".makePurchase"})," method."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#introductory-offer-eligibility",children:"Introductory offer eligibility"})," \u2013 instead of true/false we give an extended list of options."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#products-fetch-policy",children:"Products Fetch Policy"})," \u2013 we have added the ability to explicitly get products after we send the receipt to our servers."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#logging",children:"Logging"})," \u2013 We redesigned the logging module so that you can integrate your systems into it and use the logs as you see fit."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#ios-and-swift",children:"Swift"})," \u2013 our iOS SDK is now written in pure Swift."]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["We've also compiled a full list of changes, which can be found on the release page on our ",(0,s.jsx)(t.a,{href:"https://github.com/adaptyteam/AdaptySDK-iOS/releases/tag/2.0.2",children:"GitHub"})]}),"\n",(0,s.jsx)(t.h3,{id:"profile",children:"Profile"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","Previously, all information that related to the user was in the ",(0,s.jsx)(t.code,{children:"PurchaserInfo"})," model. This information was obtained by calling the ",(0,s.jsx)(t.code,{children:".getPurchaserInfo(forceUpdate:)"})," method:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"// AdaptySDK 1.x.x\nAdapty.getPurchaserInfo(forceUpdate: Bool) { (purchaserInfo, error) in\n    if error == nil {\n        // check the accesss \n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","Now we have renamed the model to ",(0,s.jsx)(t.a,{href:"sdk-models#adaptyprofile",children:(0,s.jsx)(t.code,{children:"AdaptyProfile"})}),". Also it affected the corresponding method:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"// AdaptySDK 2.0.0\nAdapty.getProfile { result in\n    if let profile = try? result.get() {\n        // check the access\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Motivation:"}),(0,s.jsx)(t.br,{}),"\n","This name reflects the essence of the model much more correctly, because not every user is a subscriber."]}),"\n",(0,s.jsxs)(t.p,{children:["This change also affected the delegate method ",(0,s.jsx)(t.code,{children:".didReceiveUpdatedProfile"})," to ",(0,s.jsx)(t.code,{children:".didLoadLatestProfile"})]}),"\n",(0,s.jsx)(t.h3,{id:"paywalls",children:"Paywalls"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","Previously, developers used to query an array of paywalls and then search that array for the desired element."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"// AdaptySDK 1.x.x\nAdapty.getPaywalls(forceUpdate: Bool) { (paywalls, products, error) in\n    if error == nil {\n        // retrieve the products from paywalls\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","We have significantly simplified this use case, so now you can get only the requested object, without touching the rest."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'// AdaptySDK 2.0.0\nAdapty.getPaywall("YOUR_PLACEMENT_ID") { result in\n    switch result {\n        case let .success(paywall):\n            // the requested paywall\n        case let .failure(error):\n            // handle the error\n    }\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Motivation:"}),(0,s.jsx)(t.br,{}),"\n","In addition to simplifying the most common usage scenario, we also significantly reduce the load on our servers, which will allow us to get a response from the server as quickly as possible."]}),"\n",(0,s.jsx)(t.h3,{id:"products",children:"Products"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","Previously the product entity was a part of the paywall, so you could use it right after ",(0,s.jsx)(t.code,{children:".getPaywalls"})," method was done. Also you could use products out of the paywalls context."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"// AdaptySDK 1.x.x\nAdapty.getPaywalls(forceUpdate: Bool) { (paywalls, products, error) in\n    if error == nil {\n        // retrieve the products from paywalls\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","Once you have obtained the desired paywall, you can query the products array for it. Now the product entity is independent, although it can only exist in the context of the paywall."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"// AdaptySDK 2.0.0\nAdapty.getPaywallProducts(paywall: paywall) { result in    \n    switch result {\n    case let .success(products):\n        // the requested products array\n    case let .failure(error):\n        // handle the error\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Motivation:"}),(0,s.jsx)(t.br,{}),"\n","We believe that this architecture will provide more flexibility in terms of receiving paywalls and products (for example, now you are not blocked by Apple when you receive a paywall), and will also optimize the load on the servers, which will speed up the response. Also, this approach is less error-prone."]}),"\n",(0,s.jsxs)(t.admonition,{type:"warning",children:[(0,s.jsx)(t.p,{children:"Products outside the paywalls"}),(0,s.jsx)(t.p,{children:"If you for some reason want to work with a product (or an array of products), please create a paywall for it. This approach is great for scaling and analytics."})]}),"\n",(0,s.jsx)(t.h3,{id:"fallback-paywalls",children:"Fallback paywalls"}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","We used to accept fallback paywalls in ",(0,s.jsx)(t.code,{children:"String"})," format:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'if let path = Bundle.main.path(forResource: "fallback_paywalls", ofType: "json"), \n   let paywalls = try? String(contentsOfFile: path, encoding: .utf8) {\n     Adapty.setFallbackPaywalls(paywalls)\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","We have now replaced this function with one that takes a parameter of type ",(0,s.jsx)(t.code,{children:"Data"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'if let urlPath = Bundle.main.url(forResource: "fallback_paywalls", withExtension: "json"),\n   let paywallsData = try? Data(contentsOf: urlPath) {\n     Adapty.setFallbackPaywalls(paywallsData)\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Motivation:"}),(0,s.jsx)(t.br,{}),"\n","We changed the type of accepted parameter to avoid unnecessary conversions."]}),"\n",(0,s.jsx)(t.h3,{id:"promotional-offers",children:"Promotional offers"}),"\n",(0,s.jsx)(t.p,{children:"If your paywall has an active promotional offer for the product you are attempting to purchase, Adapty will automatically apply that offer at the time of purchase."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","The ",(0,s.jsx)(t.code,{children:"makePurchase"})," function required the ",(0,s.jsx)(t.code,{children:"offerId"})," parameter to be passed explicitly:"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"Adapty.makePurchase(product: <product>, offerId: <offerId>) { (purchaserInfo, receipt, appleValidationResult, product, error) in\n    if error == nil {\n        // successful purchase\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","Starting with version 2.0 this parameter is no longer present. The Adapty SDK automatically uses the ",(0,s.jsx)(t.code,{children:"promotionalOfferId"})," field to apply the discount, taking the value of the ",(0,s.jsx)(t.code,{children:"promotionalOfferEligibility"})," field into account."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"Adapty.makePurchase(paywall: paywall, product: product) { result in\n    switch result {\n    case let .success(response):\n        // successful purchase\n    case let .failure(error):\n        // handle the error\n    }\n}\n"})}),"\n",(0,s.jsx)(t.admonition,{type:"warning",children:(0,s.jsxs)(t.p,{children:["Adapty signs the request according to Apple guidelines, please make sure you've uploaded ",(0,s.jsx)(t.a,{href:"app-store-connection-configuration#step-3-upload-in-app-purchase-key-file",children:"Subscription Key"})," in Adapty Dashboard when using promotional offers."]})}),"\n",(0,s.jsx)(t.h3,{id:"introductory-offer-eligibility",children:"Introductory offer eligibility"}),"\n",(0,s.jsxs)(t.p,{children:["The ",(0,s.jsx)(t.code,{children:"Product"})," entity has the ",(0,s.jsx)(t.code,{children:"introductoryOfferEligibility"})," property, it determines whether the introductory offer is available to the user (for example, a free trial period) or has already been used."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.code,{children:"introductoryOfferEligibility"})," was a Boolean value"]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.code,{children:"introductoryOfferEligibility"})," is an enumeration"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"// AdaptySDK 2.0.0\npublic enum AdaptyEligibility {\n    case unknown\n    case ineligible\n    case eligible\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Motivation:"}),(0,s.jsx)(t.br,{}),"\n",(0,s.jsx)(t.strong,{children:"StoreKit"})," does not provide a convenient and reliable way to determine this value, so we have to do it by analyzing the receipt from the system. Since there are cases when this receipt is missing, we decided to inform you about these situations using the value ",(0,s.jsx)(t.code,{children:"unknown"}),". We recommend working with ",(0,s.jsx)(t.code,{children:"unknown"})," in the same way as ",(0,s.jsx)(t.code,{children:"ineligible"}),"."]}),"\n",(0,s.jsx)(t.h3,{id:"products-fetch-policy",children:"Products fetch policy"}),"\n",(0,s.jsxs)(t.p,{children:["As mentioned in the previous section, StoreKit version 1 does not allow you to reliably determine the value of the ",(0,s.jsx)(t.code,{children:"introductoryOfferEligibility"})," without analyzing the receipt. Despite the fact that a missing receipt at startup is a pretty rare situation, we have added the ability to explicitly get products after we send the receipt to our servers."]}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","In previous versions, the ",(0,s.jsx)(t.code,{children:"syncTransactionsHistory"})," function was added for such situations, which often conflicted with internal SDK calls, slowing it down."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'Adapty.syncTransactionsHistory { params, products, error in\n    Adapty.getPaywall("paywall_id") { paywall, error in\n        // use paywall and products\n    }\n}\n'})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","Now this mechanism is implemented much more reliably, we will try to request a receipt in its unavailability in advance, and there is a special parameter of ",(0,s.jsx)(t.code,{children:".getPaywallProducts"})," function to get products with a correct ",(0,s.jsx)(t.code,{children:"introductoryOfferEligibility"}),":"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"Adapty.getPaywallProducts(paywall: paywall, fetchPolicy: .waitForReceiptValidation) { result in\n    if let products = try? result.get() {\n        // update your UI\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Motivation:"}),(0,s.jsx)(t.br,{}),"\n","The call sequence for the correct functioning of the system was unobvious and less reliable.",(0,s.jsx)(t.br,{}),"\n","We recommend first requesting products without overriding ",(0,s.jsx)(t.code,{children:"fetchPolicy"}),", and then immediately rendering the UI. If you get back objects with an unknown ",(0,s.jsx)(t.code,{children:"introductoryOfferEligibility"})," value, you can re-request products with ",(0,s.jsx)(t.code,{children:".waitForReceiptValidation"})," policy and update the UI afterward.",(0,s.jsx)(t.br,{}),"\n","Read more about handling such a scenario in the ",(0,s.jsx)(t.a,{href:"display-remote-config-paywalls",children:(0,s.jsx)(t.em,{children:"Displaying Paywalls & Products"})})," section."]}),"\n",(0,s.jsx)(t.h3,{id:"logging",children:"Logging"}),"\n",(0,s.jsx)(t.p,{children:"It is critical for a library such as ours to have an understandable and customizable logging system. Just as before, our SDK has several levels of logging, but now you can also override the stream the messages will be sent to. By default, messages will be sent to the console, but you can optionally write them to a file or send them to your favorite logging system."}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'Adapty.setLogHandler { level, message in\n    logToSomeFancyLoggingSystem("Adapty \\(level): \\(message)")\n}\n'})}),"\n",(0,s.jsx)(t.h3,{id:"ios-and-swift",children:"iOS and Swift"}),"\n",(0,s.jsxs)(t.p,{children:["Despite the fact that technically the first version of the SDK was written in Swift, we were forced to maintain backward compatibility with Objective-C, as there are a huge number of projects created using this obsolete programming language.",(0,s.jsx)(t.br,{}),"\n","This approach prevented us from using Swift to its full potential. We did not take full advantage of the Value Types, as well as the many other features available only in Swift."]}),"\n",(0,s.jsx)(t.p,{children:"For example, we can now happily use the built-in Result type. This led to a slight change in callbacks in many places in the public API."}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"Before:"}),(0,s.jsx)(t.br,{}),"\n","The callback contains a lot of variables, including an error."]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"Adapty.makePurchase(product: <product>, offerId: <offerId>) { (purchaserInfo, receipt, appleValidationResult, product, error) in\n    if error == nil {\n        // successful purchase\n    }\n}\n"})}),"\n",(0,s.jsxs)(t.p,{children:[(0,s.jsx)(t.strong,{children:"After:"}),(0,s.jsx)(t.br,{}),"\n","A much more elegant and familiar way to handle the result"]}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"Adapty.makePurchase(paywall: paywall, product: product) { result in\n    switch result {\n    case let .success(response):\n        // successful purchase\n    case let .failure(error):\n        // handle the error\n    }\n}\n"})}),"\n",(0,s.jsx)(t.h3,{id:"in-lieu-of-a-conclusion",children:"In lieu of a conclusion"}),"\n",(0,s.jsx)(t.p,{children:'In this article, we have listed the most significant changes introduced in the new version, which can be seen in the public API. However, most of the improvements are hidden "under the hood" and are not mentioned here. Of course, we\'ve completely updated our documentation to reflect the new release, so you can feel free to use it.'}),"\n",(0,s.jsxs)(t.p,{children:["You can find the complete list of changes on the ",(0,s.jsx)(t.a,{href:"https://github.com/adaptyteam/AdaptySDK-iOS/releases/tag/2.0.2",children:"release page"}),"."]}),"\n",(0,s.jsx)(t.p,{children:"Stay tuned for more updates!"}),"\n",(0,s.jsx)(t.hr,{}),"\n",(0,s.jsx)(t.p,{children:(0,s.jsx)(t.strong,{children:"What's next:"})}),"\n",(0,s.jsxs)(t.ul,{children:["\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.a,{href:"migration-to-adapty-sdk-v3",children:"Migrate to Adapty SDK 3.0.x"})}),"\n"]})]})}function h(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);