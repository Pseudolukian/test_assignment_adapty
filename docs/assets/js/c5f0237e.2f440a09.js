"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[6152],{67476:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/webhook-setup-eaf3d699eb7bfc447f56a2a119671578.webp"},75373:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>h,contentTitle:()=>d,default:()=>p,frontMatter:()=>r,metadata:()=>a,toc:()=>l});var s=n(74848),i=n(28453),o=n(34028);n(26393);const r={title:"Set up webhook integration",description:"Set up webhook integration in Adapty to automate event tracking.",metadataTitle:"Setting Up Webhook Integration | Adapty Docs"},d=void 0,a={id:"set-up-webhook-integration",title:"Set up webhook integration",description:"Set up webhook integration in Adapty to automate event tracking.",source:"@site/versioned_docs/version-3.0/set-up-webhook-integration.md",sourceDirName:".",slug:"/set-up-webhook-integration",permalink:"/test_assignment_adapty/docs/set-up-webhook-integration",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"Set up webhook integration",description:"Set up webhook integration in Adapty to automate event tracking.",metadataTitle:"Setting Up Webhook Integration | Adapty Docs"},sidebar:"tutorialSidebar",previous:{title:"Event Types and Fields",permalink:"/test_assignment_adapty/docs/webhook-event-types-and-fields"},next:{title:"Test webhook integration",permalink:"/test_assignment_adapty/docs/test-webhook"}},h={},l=[{value:"Set up your server to process Adapty requests",id:"set-up-your-server-to-process-adapty-requests",level:2},{value:"Verification request",id:"verification-request",level:3},{value:"Subscription events",id:"subscription-events",level:3},{value:"Configure webhook integration in the Adapty Dashboard",id:"configure-webhook-integration-in-the-adapty-dashboard",level:2},{value:"Choose events to send and map event names",id:"choose-events-to-send-and-map-event-names",level:3},{value:"Handle webhook events",id:"handle-webhook-events",level:2}];function c(e){const t={a:"a",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,i.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(t.p,{children:["Adapty ",(0,s.jsx)(t.a,{href:"webhook",children:"webhook integration"})," consists of the following steps:"]}),"\n",(0,s.jsx)(o.A,{children:(0,s.jsx)("img",{src:n(67476).A,style:{border:"1px solid #727272",width:"300px",display:"block",margin:"0 auto"}})}),"\n",(0,s.jsx)("p",{}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"You set up your endpoint:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Ensure your server can process Adapty requests with the ",(0,s.jsx)(t.strong,{children:"Content-Type"})," header set to ",(0,s.jsx)(t.code,{children:"application/json"}),"."]}),"\n",(0,s.jsxs)(t.li,{children:["Configure your server to receive Adapty's verification request and respond with any ",(0,s.jsx)(t.code,{children:"2xx"})," status and a JSON body."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#subscription-events",children:"Handle subscription events"})," once the connection is verified."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"You configure and enable the webhook integration"})," in the ",(0,s.jsx)(t.a,{href:"#configure-webhook-integration-in-the-adapty-dashboard",children:"Adapty Dashboard"}),". You can also ",(0,s.jsx)(t.a,{href:"#configure-webhook-integration-in-the-adapty-dashboard",children:"map Adapty events to custom event names"}),". We recommend testing in the ",(0,s.jsx)(t.strong,{children:"Sandbox environment"})," before switching to production."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Adapty sends a verification request"})," to your server."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.strong,{children:"Your server responds"})," with a ",(0,s.jsx)(t.code,{children:"2XX"})," status and a JSON body."]}),"\n",(0,s.jsx)(t.li,{children:(0,s.jsx)(t.strong,{children:"Once Adapty receives a valid response, it starts sending subscription events."})}),"\n"]}),"\n",(0,s.jsx)(t.h2,{id:"set-up-your-server-to-process-adapty-requests",children:"Set up your server to process Adapty requests"}),"\n",(0,s.jsx)(t.p,{children:"Adapty will send to your webhook endpoint 2 types of requests:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#verification-request",children:"Verification request"}),": the initial request to verify the connection is set up correctly. This request will not contain any event and will be sent the moment you click the ",(0,s.jsx)(t.strong,{children:"Save"})," button in the Webhook integration of the Adapty Dashboard. To confirm your endpoint successfully received the verification request, your endpoint should answer with the verification response."]}),"\n",(0,s.jsxs)(t.li,{children:[(0,s.jsx)(t.a,{href:"#subscription-events",children:"Subscription event"}),": A standard request Adapty server sends every time an event is created in it. Your server does not need to reply with any specific response. The only thing the Adapty server needs is to receive a standard 200-code HTTP response if it successfully receives the message."]}),"\n"]}),"\n",(0,s.jsx)(t.h3,{id:"verification-request",children:"Verification request"}),"\n",(0,s.jsxs)(t.p,{children:["After you enable webhook integration in the Adapty Dashboard, Adapty will send a POST verification request containing an empty JSON object ",(0,s.jsx)(t.code,{children:"{}"})," as a body."]}),"\n",(0,s.jsxs)(t.p,{children:["Set up your endpoint to have the ",(0,s.jsx)(t.strong,{children:"Content-Type header"})," as ",(0,s.jsx)(t.code,{children:"application/json"}),", i.e. your server's endpoint should expect the incoming webhook request to have its payload formatted as JSON."]}),"\n",(0,s.jsx)(t.p,{children:"Your server must reply with a 2xx status code and send any valid JSON response, for example:"}),"\n",(0,s.jsx)(t.pre,{children:(0,s.jsx)(t.code,{className:"language-json",metastring:'title="Json"',children:"{}\n"})}),"\n",(0,s.jsx)(t.p,{children:"Once Adapty receives the verification response in the correct format and with a 2xx status code, your Adapty webhook integration is fully configured."}),"\n",(0,s.jsx)(t.h3,{id:"subscription-events",children:"Subscription events"}),"\n",(0,s.jsxs)(t.p,{children:["Subscription events are sent with the ",(0,s.jsx)(t.strong,{children:"Content-Type"})," header set to ",(0,s.jsx)(t.code,{children:"application/json"})," and contain event data in JSON format. For possible event types and request structures, see ",(0,s.jsx)(t.a,{href:"webhook-event-types-and-fields",children:"Webhook event types and fields"}),"."]}),"\n",(0,s.jsx)(t.h2,{id:"configure-webhook-integration-in-the-adapty-dashboard",children:"Configure webhook integration in the Adapty Dashboard"}),"\n",(0,s.jsx)(t.p,{children:"Within Adapty, you can configure separate flows for production events and test events received from the Apple or Stripe sandbox environment or Google test account."}),"\n",(0,s.jsxs)(t.p,{children:["For production events, use the ",(0,s.jsx)(t.strong,{children:"Production endpoint URL"})," field specifying the URL to which the callbacks will be sent. Additionally, configure the ",(0,s.jsx)(t.strong,{children:"Authorization header value for production endpoint"})," field - the header for your server to authenticate Adapty events. Note that we'll use the value specified in the ",(0,s.jsx)(t.strong,{children:"Authorization header value for production endpoint"})," field as the ",(0,s.jsx)(t.code,{children:"Authorization"})," header exactly as provided, without any changes or additions."]}),"\n",(0,s.jsxs)(t.p,{children:["For test events, employ the  ",(0,s.jsx)(t.strong,{children:"Sandbox endpoint URL"})," and ",(0,s.jsx)(t.strong,{children:"Authorization header value for sandbox endpoint"})," fields accordingly."]}),"\n",(0,s.jsx)(t.p,{children:"To set up the webhook integration:"}),"\n",(0,s.jsxs)(t.ol,{children:["\n",(0,s.jsxs)(t.li,{children:["Open ",(0,s.jsx)(t.a,{href:"https://app.adapty.io/integrations/customwebhook",children:"Integrations -> Webhook"})," in your Adapty Dashboard."]}),"\n"]}),"\n",(0,s.jsx)(o.A,{children:(0,s.jsx)("img",{src:n(86205).A,style:{border:"1px solid #727272",width:"700px",display:"block",margin:"0 auto"}})}),"\n",(0,s.jsxs)(t.ol,{start:"2",children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Turn on the toggle to initiate the integration."}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Fill out the integration fields:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Field"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Production endpoint URL"})}),(0,s.jsx)(t.td,{children:"The URL Adapty uses to send HTTP POST requests for events in production."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Authorization header value for production endpoint"})}),(0,s.jsxs)(t.td,{children:[(0,s.jsxs)("p",{children:["The header that your server will use to authenticate requests from Adapty in production. Note that we'll use the value specified in this field as the ",(0,s.jsx)(t.code,{children:"Authorization"})," header exactly as provided, without any changes or additions."]}),(0,s.jsx)("p",{}),(0,s.jsx)("p",{children:"Although not mandatory, it's strongly recommended for enhanced security."})]})]})]})]}),"\n",(0,s.jsx)(t.p,{children:"Additionally, for your testing needs in the sandbox environment, two other fields are available:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{children:"Testing field"}),(0,s.jsx)(t.th,{children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Sandbox endpoint URL"})}),(0,s.jsx)(t.td,{children:"The URL Adapty uses to send HTTP POST requests for events in the sandbox environment."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{children:(0,s.jsx)(t.strong,{children:"Authorization header value for sandbox endpoint"})}),(0,s.jsxs)(t.td,{children:[(0,s.jsxs)("p",{children:["The header that your server will use to authenticate requests from Adapty during testing in the sandbox environment. Note that we'll use the value specified in this field as the ",(0,s.jsx)(t.code,{children:"Authorization"})," header exactly as provided, without any changes or additions."]}),(0,s.jsx)("p",{}),(0,s.jsx)("p",{children:"Although not mandatory, it's strongly recommended for enhanced security."})]})]})]})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["(optional) Pick the events you want to receive and map their names. Check out our ",(0,s.jsx)(t.a,{href:"event-flows",children:"Event flows"})," to see which events are triggered in different situations."]}),"\n",(0,s.jsxs)(t.p,{children:["If your event IDs differ from those used in Adapty, keep the IDs in your system as is and replace the default Adapty event IDs with yours in the ",(0,s.jsx)(t.strong,{children:"Events names"})," section of the ",(0,s.jsx)(t.a,{href:"https://app.adapty.io/integrations/customwebhook",children:"Integrations ->  Webhooks"})," page."]}),"\n",(0,s.jsx)(t.p,{children:"The event ID can be any string; simply make sure the event ID in your webhook processing server coincides with the one you entered in the Adapty Dashboard. You cannot leave the event ID empty for enabled events."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(o.A,{children:(0,s.jsx)("img",{src:n(93694).A,style:{border:"1px solid #727272",width:"700px",display:"block",margin:"0 auto"}})}),"\n",(0,s.jsxs)(t.ol,{start:"5",children:["\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsx)(t.p,{children:"Additional fields and options are not obligatory; use them as needed:"}),"\n",(0,s.jsxs)(t.table,{children:[(0,s.jsx)(t.thead,{children:(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Setting"}),(0,s.jsx)(t.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,s.jsxs)(t.tbody,{children:[(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Send Trial Price"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["When enabled, Adapty will include the subscription price in the ",(0,s.jsx)(t.code,{children:"price_local"})," and ",(0,s.jsx)(t.code,{children:"price_usd"})," fields for the ",(0,s.jsx)(t.strong,{children:"Trial Started"})," event."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Exclude Historical Events"})}),(0,s.jsx)(t.td,{style:{textAlign:"left"},children:"Opt to exclude events that occurred before the user installed the app with Adapty SDK. This prevents duplication of events and ensures accurate reporting. For instance, if a user activated a monthly subscription on January 10th and updated the app with Adapty SDK on March 6th, Adapty will omit events before March 6th and retain subsequent events."})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Send user attributes"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Enable this option to send user-specific attributes, such as language preferences. These attributes will appear in the ",(0,s.jsx)(t.code,{children:"user_attributes"})," field. See ",(0,s.jsx)(t.a,{href:"webhook-event-types-and-fields#event-fields",children:"Event fields"})," for more information."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Send attribution"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Turn on this option to include attribution information (e.g., AppsFlyer data) in the ",(0,s.jsx)(t.code,{children:"attributions"})," field. Refer to the ",(0,s.jsx)(t.a,{href:"webhook-event-types-and-fields#attribution-data",children:"Attribution data"})," section for details."]})]}),(0,s.jsxs)(t.tr,{children:[(0,s.jsx)(t.td,{style:{textAlign:"left"},children:(0,s.jsx)(t.strong,{children:"Send Play Store purchase token"})}),(0,s.jsxs)(t.td,{style:{textAlign:"left"},children:["Turn on this option to receive the Play Store token required for purchase revalidation, if needed. Enabling it will add the ",(0,s.jsx)(t.code,{children:"play_store_purchase_token"})," parameter to the event. For details on its content, refer to the ",(0,s.jsx)(t.a,{href:"webhook-event-types-and-fields#play-store-purchase-token",children:"Play Store purchase token"})," section."]})]})]})]}),"\n"]}),"\n",(0,s.jsxs)(t.li,{children:["\n",(0,s.jsxs)(t.p,{children:["Remember to click the ",(0,s.jsx)(t.strong,{children:"Save"})," button to confirm the changes."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(t.p,{children:["The moment you click the ",(0,s.jsx)(t.strong,{children:"Save"})," button, Adapty will send a verification request and will wait for your server verification response."]}),"\n",(0,s.jsx)(t.h3,{id:"choose-events-to-send-and-map-event-names",children:"Choose events to send and map event names"}),"\n",(0,s.jsxs)(t.p,{children:["Choose the events you want to receive in your server by enabling the toggle next to it. If your event names differ from those used in Adapty and you need to keep your names as is, you can set up the mapping by replacing the default Adapty event names with your own in the ",(0,s.jsx)(t.strong,{children:"Events names"})," section of the ",(0,s.jsx)(t.a,{href:"https://app.adapty.io/integrations/customwebhook",children:"Integrations ->  Webhooks"})," page."]}),"\n",(0,s.jsx)(o.A,{children:(0,s.jsx)("img",{src:n(93694).A,style:{border:"1px solid #727272",width:"700px",display:"block",margin:"0 auto"}})}),"\n",(0,s.jsxs)(t.p,{children:["The event name can be any string. You cannot leave the fields empty for enabled events. If you accidentally removed Adapty event name, you can always copy the name from the ",(0,s.jsx)(t.a,{href:"events",children:"Events to send to third-party integrations"})," topic."]}),"\n",(0,s.jsx)(t.h2,{id:"handle-webhook-events",children:"Handle webhook events"}),"\n",(0,s.jsx)(t.p,{children:"Webhooks are typically delivered within 5 to 60 seconds after the event occurs. Cancellation events, however, may take up to 2 hours to be delivered after a user cancels their subscription.\nIf your server's response status code is outside the 200-404 range, Adapty will retry sending the event up to 9 times over 24 hours with exponential backoff. We suggest you set up your webhook to do only basic validation of the event body from Adapty before responding. If your server can't process the event and you don't want Adapty to retry, use a status code within the 200-404 range. Also, handle any time-consuming tasks asynchronously and respond to Adapty quickly. If Adapty doesn't receive a response within 10 seconds, it will consider the attempt a failure and will retry."})]})}function p(e={}){const{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,s.jsx)(t,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},86205:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/webhook_integration-f56d1bd637b8992ffcb9afa52c07318e.webp"},93694:(e,t,n)=>{n.d(t,{A:()=>s});const s=n.p+"assets/images/86942b8-event_names_renaming-8328375600c8111de59cad7163d48b2a.webp"}}]);