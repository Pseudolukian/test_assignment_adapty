"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[1083],{20037:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>h,frontMatter:()=>t,metadata:()=>d,toc:()=>o});var i=r(74848),s=r(28453);const t={title:"Android - Handle paywall events",description:"Handle subscription events in Android (Legacy) with Adapty SDK.",metadataTitle:"Handling Events on Android (Legacy) | Adapty Docs",toc_max_heading_level:4},l=void 0,d={id:"android-handling-events-legacy",title:"Android - Handle paywall events",description:"Handle subscription events in Android (Legacy) with Adapty SDK.",source:"@site/versioned_docs/version-3.0/android-handling-events-legacy.md",sourceDirName:".",slug:"/android-handling-events-legacy",permalink:"/docs/android-handling-events-legacy",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"Android - Handle paywall events",description:"Handle subscription events in Android (Legacy) with Adapty SDK.",metadataTitle:"Handling Events on Android (Legacy) | Adapty Docs",toc_max_heading_level:4},sidebar:"tutorialSidebar",previous:{title:"iOS",permalink:"/docs/ios-handling-events-legacy"},next:{title:"Flutter",permalink:"/docs/flutter-handling-events-legacy"}},a={},o=[{value:"User-generated events",id:"user-generated-events",level:3},{value:"Actions",id:"actions",level:4},{value:"Product selection",id:"product-selection",level:4},{value:"Started purchase",id:"started-purchase",level:4},{value:"Canceled purchase",id:"canceled-purchase",level:4},{value:"Successful purchase",id:"successful-purchase",level:4},{value:"Failed purchase",id:"failed-purchase",level:4},{value:"Successful restore",id:"successful-restore",level:4},{value:"Failed restore",id:"failed-restore",level:4},{value:"Data fetching and rendering",id:"data-fetching-and-rendering",level:3},{value:"Product loading errors",id:"product-loading-errors",level:4},{value:"Rendering errors",id:"rendering-errors",level:4}];function c(e){const n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",em:"em",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["Paywalls configured with the ",(0,i.jsx)(n.a,{href:"adapty-paywall-builder-legacy",children:"Paywall Builder"})," don't need extra code to make and restore purchases. However, they generate some events that your app can respond to. Those events include button presses (close buttons, URLs, product selections, and so on) as well as notifications on purchase-related actions taken on the paywall. Learn how to respond to these events below."]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["This guide is for ",(0,i.jsx)(n.strong,{children:"legacy Paywall Builder paywalls"})," only which require Adapty SDK up to v2.x. For presenting paywalls in Adapty SDK v3.0 or later designed with the new Paywall Builder, see ",(0,i.jsx)(n.a,{href:"android-handling-events",children:"Android - Handle paywall events designed with the new Paywall Builder"}),"."]})}),"\n",(0,i.jsxs)(n.p,{children:["If you need to control or monitor the processes that take place on the purchase screen, implement the ",(0,i.jsx)(n.code,{children:"AdaptyUiEventListener"})," methods."]}),"\n",(0,i.jsxs)(n.p,{children:["If you would like to leave the default behavior in some cases, you can extend ",(0,i.jsx)(n.code,{children:"AdaptyUiDefaultEventListener"})," and override only those methods you want to change."]}),"\n",(0,i.jsxs)(n.p,{children:["Below are the defaults from ",(0,i.jsx)(n.code,{children:"AdaptyUiDefaultEventListener"}),"."]}),"\n",(0,i.jsx)(n.h3,{id:"user-generated-events",children:"User-generated events"}),"\n",(0,i.jsx)(n.h4,{id:"actions",children:"Actions"}),"\n",(0,i.jsxs)(n.p,{children:["If a user has performed some action  (",(0,i.jsx)(n.code,{children:"Close"}),", ",(0,i.jsx)(n.code,{children:"OpenURL"})," or ",(0,i.jsx)(n.code,{children:"Custom"}),", this method will be invoked:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"override fun onActionPerformed(action: AdaptyUI.Action, view: AdaptyPaywallView) {\n    when (action) {\n        AdaptyUI.Action.Close -> (view.context as? Activity)?.onBackPressed()\n        \n        is AdaptyUI.Action.OpenUrl -> //launching intent to open url\n        \n        is AdaptyUI.Action.Custom -> //no default action\n    }\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"The following action types are supported:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Close"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"OpenUrl(url)"})}),"\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.code,{children:"Custom(id)"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["Note that at the very least you need to implement the reactions to both ",(0,i.jsx)(n.code,{children:"Close"})," and ",(0,i.jsx)(n.code,{children:"OpenURL"}),". For example, if a user taps the close button, the action ",(0,i.jsx)(n.code,{children:"Close"})," will occur and you are supposed to dismiss the paywall."]}),"\n",(0,i.jsx)(n.admonition,{type:"warning",children:(0,i.jsxs)(n.p,{children:["This method is ",(0,i.jsx)(n.em,{children:"not"})," invoked when user taps the system back button instead of the close icon on the screen."]})}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\ud83d\udca1 Login Action"}),"\n",(0,i.jsxs)(n.p,{children:["If you have configured Login Action in the dashboard, you should implement reaction for custom action with id ",(0,i.jsx)(n.code,{children:'"login"'})]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"product-selection",children:"Product selection"}),"\n",(0,i.jsx)(n.p,{children:"If a product is selected for purchase (by a user or by the system), this method will be invoked:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onProductSelected(\n    product: AdaptyPaywallProduct,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsx)(n.h4,{id:"started-purchase",children:"Started purchase"}),"\n",(0,i.jsx)(n.p,{children:"If a user initiates the purchase process, this method will be invoked:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onPurchaseStarted(\n    product: AdaptyPaywallProduct,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The method will not be invoked in Observer mode. Refer to the ",(0,i.jsx)(n.a,{href:"android-present-paywall-builder-paywalls-in-observer-mode",children:"Android - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,i.jsx)(n.h4,{id:"canceled-purchase",children:"Canceled purchase"}),"\n",(0,i.jsxs)(n.p,{children:["If a user initiates the purchase process but manually interrupts it afterward, the method below will be invoked. This event occurs when the ",(0,i.jsx)(n.code,{children:"Adapty.makePurchase()"})," function completes with the ",(0,i.jsx)(n.code,{children:"USER_CANCELED"})," error:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onPurchaseCanceled(\n    product: AdaptyPaywallProduct,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The method will not be invoked in Observer mode. Refer to the ",(0,i.jsx)(n.a,{href:"android-present-paywall-builder-paywalls-in-observer-mode",children:"Android - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,i.jsx)(n.h4,{id:"successful-purchase",children:"Successful purchase"}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"Adapty.makePurchase()"})," succeeds, this method will be invoked:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onPurchaseSuccess(\n    profile: AdaptyProfile?,\n    product: AdaptyPaywallProduct,\n    view: AdaptyPaywallView,\n) {\n    (view.context as? Activity)?.onBackPressed()\n}\n"})}),"\n",(0,i.jsx)(n.p,{children:"We recommend dismissing the screen in that case."}),"\n",(0,i.jsxs)(n.p,{children:["The method will not be invoked in Observer mode. Refer to the ",(0,i.jsx)(n.a,{href:"android-present-paywall-builder-paywalls-in-observer-mode",children:"Android - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,i.jsx)(n.h4,{id:"failed-purchase",children:"Failed purchase"}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"Adapty.makePurchase()"})," fails, this method will be invoked:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onPurchaseFailure(\n    error: AdaptyError,\n    product: AdaptyPaywallProduct,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["The method will not be invoked in Observer mode. Refer to the ",(0,i.jsx)(n.a,{href:"android-present-paywall-builder-paywalls-in-observer-mode",children:"Android - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,i.jsx)(n.h4,{id:"successful-restore",children:"Successful restore"}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"Adapty.restorePurchases()"})," succeeds, this method will be invoked:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onRestoreSuccess(\n    profile: AdaptyProfile,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsxs)(n.p,{children:["We recommend dismissing the screen if the user has the required ",(0,i.jsx)(n.code,{children:"accessLevel"}),". Refer to the ",(0,i.jsx)(n.a,{href:"subscription-status",children:"Subscription status"})," topic to learn how to check it."]}),"\n",(0,i.jsx)(n.h4,{id:"failed-restore",children:"Failed restore"}),"\n",(0,i.jsxs)(n.p,{children:["If ",(0,i.jsx)(n.code,{children:"Adapty.restorePurchases()"})," fails, this method will be invoked:"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onRestoreFailure(\n    error: AdaptyError,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"data-fetching-and-rendering",children:"Data fetching and rendering"}),"\n",(0,i.jsx)(n.h4,{id:"product-loading-errors",children:"Product loading errors"}),"\n",(0,i.jsx)(n.p,{children:"If you don't pass the products during the initialization, AdaptyUI will retrieve the necessary objects from the server by itself. If this operation fails, AdaptyUI will report the error by invoking this method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onLoadingProductsFailure(\n    error: AdaptyError,\n    view: AdaptyPaywallView,\n): Boolean = false\n"})}),"\n",(0,i.jsxs)(n.p,{children:["If you return ",(0,i.jsx)(n.code,{children:"true"}),", AdaptyUI will repeat the request in 2 seconds."]}),"\n",(0,i.jsx)(n.h4,{id:"rendering-errors",children:"Rendering errors"}),"\n",(0,i.jsx)(n.p,{children:"If an error occurs during the interface rendering, it will be reported by calling this method:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-kotlin",metastring:'showLineNumbers title="Kotlin"',children:"public override fun onRenderingError(\n    error: AdaptyError,\n    view: AdaptyPaywallView,\n) {}\n"})}),"\n",(0,i.jsx)(n.p,{children:"In a normal situation, such errors should not occur, so if you come across one, please let us know."})]})}function h(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}}}]);