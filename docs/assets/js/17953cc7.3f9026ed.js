"use strict";(self.webpackChunkadapty_docs=self.webpackChunkadapty_docs||[]).push([[7829],{4747:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>s,metadata:()=>d,toc:()=>c});var r=t(74848),i=t(28453),l=(t(26393),t(97808));const s={title:"iOS - Handle paywall events",description:"Handle subscription-related events in iOS using Adapty for better app monetization.",metadataTitle:"Handling Events in iOS | Adapty Docs",toc_max_heading_level:4},a=void 0,d={id:"ios-handling-events",title:"iOS - Handle paywall events",description:"Handle subscription-related events in iOS using Adapty for better app monetization.",source:"@site/versioned_docs/version-3.0/ios-handling-events.md",sourceDirName:".",slug:"/ios-handling-events",permalink:"/test_assignment_adapty/docs/ios-handling-events",draft:!1,unlisted:!1,tags:[],version:"3.0",frontMatter:{title:"iOS - Handle paywall events",description:"Handle subscription-related events in iOS using Adapty for better app monetization.",metadataTitle:"Handling Events in iOS | Adapty Docs",toc_max_heading_level:4},sidebar:"tutorialSidebar",previous:{title:"Handle paywall events",permalink:"/test_assignment_adapty/docs/handling-pb-paywall-events"},next:{title:"Android",permalink:"/test_assignment_adapty/docs/android-handling-events"}},o={},c=[...l.RM,{value:"Handling events in Swift",id:"handling-events-in-swift",level:2},{value:"User-generated events",id:"user-generated-events",level:3},{value:"Actions",id:"actions",level:4},{value:"Product selection",id:"product-selection",level:4},{value:"Started purchase",id:"started-purchase",level:4},{value:"Successful or canceled purchase",id:"successful-or-canceled-purchase",level:4},{value:"Failed purchase",id:"failed-purchase",level:4},{value:"Successful restore",id:"successful-restore",level:4},{value:"Failed restore",id:"failed-restore",level:4},{value:"Data fetching and rendering",id:"data-fetching-and-rendering",level:3},{value:"Product loading errors",id:"product-loading-errors",level:4},{value:"Rendering errors",id:"rendering-errors",level:4},{value:"Handling events in SwiftUI",id:"handling-events-in-swiftui",level:2}];function h(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(n.p,{children:["Paywalls configured with the ",(0,r.jsx)(n.a,{href:"adapty-paywall-builder",children:"Paywall Builder"})," don't need extra code to make and restore purchases. However, they generate some events that your app can respond to. Those events include button presses (close buttons, URLs, product selections, and so on) as well as notifications on purchase-related actions taken on the paywall. Learn how to respond to these events below."]}),"\n",(0,r.jsx)(n.admonition,{type:"warning",children:(0,r.jsxs)(n.p,{children:["This guide is for ",(0,r.jsx)(n.strong,{children:"new Paywall Builder paywalls"})," only which require Adapty SDK v3.0 or later. For presenting paywalls in Adapty SDK v2 designed with legacy Paywall Builder, see ",(0,r.jsx)(n.a,{href:"ios-handling-events-legacy",children:"iOS - Handle paywall events designed with legacy Paywall Builder"}),"."]})}),"\n",(0,r.jsx)(l.Ay,{}),"\n",(0,r.jsx)(n.h2,{id:"handling-events-in-swift",children:"Handling events in Swift"}),"\n",(0,r.jsxs)(n.p,{children:["To control or monitor processes occurring on the paywall screen within your mobile app, implement the ",(0,r.jsx)(n.code,{children:"AdaptyPaywallControllerDelegate"})," methods."]}),"\n",(0,r.jsx)(n.h3,{id:"user-generated-events",children:"User-generated events"}),"\n",(0,r.jsx)(n.h4,{id:"actions",children:"Actions"}),"\n",(0,r.jsxs)(n.p,{children:["When a user performs an action (like clicking a close, custom button, or opening a URL), the ",(0,r.jsx)(n.code,{children:"paywallController(_:didPerform:)"})," method will be triggered. You\u2019ll need to define what each action should do."]}),"\n",(0,r.jsx)(n.p,{children:"The following built-in actions are supported:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"close"})}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"openURL(url)"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["Custom actions are handled differently. For example, if a user taps a custom button, like ",(0,r.jsx)(n.strong,{children:"Login"})," or ",(0,r.jsx)(n.strong,{children:"Open another paywall"}),", the delegate method ",(0,r.jsx)(n.code,{children:"paywallController(_:didPerform:)"})," will be triggered with the ",(0,r.jsx)(n.code,{children:".custom(id:)"})," case and the ",(0,r.jsx)(n.code,{children:"id"})," parameter is the ",(0,r.jsx)(n.strong,{children:"Button action ID"}),' from the Adapty Dashboard. The ID for the custom action "login" is predefined, but for other custom actions, you can create your own IDs, like "open_another_paywall".']}),"\n",(0,r.jsx)(n.p,{children:"Here\u2019s an example, but feel free to handle the actions in your own way:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'func paywallController(_ controller: AdaptyPaywallController,\n                       didPerform action: AdaptyUI.Action) {\n\n    switch action {\n        case .close:\n            controller.dismiss(animated: true)\n        case let .openURL(url):\n      \t\t\t// handle URL opens (incl. terms and privacy links)\n            UIApplication.shared.open(url, options: [:])\n        case let .custom(id):\n            if id == "login" {\n               // implement login flow \n            }\n            break\n    }\n}\n'})}),"\n",(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Make sure to implement responses for all ",(0,r.jsx)(n.a,{href:"paywall-buttons",children:"built-in and custom actions"})," you\u2019ve set up on your paywall in the Adapty Dashboard."]})}),"\n",(0,r.jsx)(n.h4,{id:"product-selection",children:"Product selection"}),"\n",(0,r.jsx)(n.p,{children:"If a user selects a product for purchase, this method will be invoked:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"    func paywallController(\n        _ controller: AdaptyPaywallController,\n        didSelectProduct product: AdaptyPaywallProductWithoutDeterminingOffer\n    ) { }\n"})}),"\n",(0,r.jsx)(n.h4,{id:"started-purchase",children:"Started purchase"}),"\n",(0,r.jsx)(n.p,{children:"If a user initiates the purchase process, this method will be invoked:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(_ controller: AdaptyPaywallController,\n                       didStartPurchase product: AdaptyPaywallProduct) {\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(n.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,r.jsx)(n.h4,{id:"successful-or-canceled-purchase",children:"Successful or canceled purchase"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"Adapty.makePurchase()"})," succeeds, this method will be invoked:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(\n    _ controller: AdaptyPaywallController,\n    didFinishPurchase product: AdaptyPaywallProductWithoutDeterminingOffer,\n    purchaseResult: AdaptyPurchaseResult\n) {\n    if !purchaseResult.isPurchaseCancelled {\n        controller.dismiss(animated: true)\n    }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"We recommend dismissing the paywall screen in that case."}),"\n",(0,r.jsxs)(n.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(n.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,r.jsx)(n.h4,{id:"failed-purchase",children:"Failed purchase"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"Adapty.makePurchase()"})," fails, this method will be invoked:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(\n    _ controller: AdaptyPaywallController,\n    didFailPurchase product: AdaptyPaywallProduct,\n    error: AdaptyError\n) { }\n"})}),"\n",(0,r.jsxs)(n.p,{children:["It will not be invoked in Observer mode. Refer to the ",(0,r.jsx)(n.a,{href:"ios-present-paywall-builder-paywalls-in-observer-mode",children:"iOS - Present Paywall Builder paywalls in Observer mode"})," topic for details."]}),"\n",(0,r.jsx)(n.h4,{id:"successful-restore",children:"Successful restore"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"Adapty.restorePurchases()"})," succeeds, this method will be invoked:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"func paywallController(\n    _ controller: AdaptyPaywallController, \n    didFinishRestoreWith profile: AdaptyProfile\n) { }\n"})}),"\n",(0,r.jsxs)(n.p,{children:["We recommend dismissing the screen if a the has the required ",(0,r.jsx)(n.code,{children:"accessLevel"}),". Refer to the ",(0,r.jsx)(n.a,{href:"subscription-status",children:"Subscription status"})," topic to learn how to check it."]}),"\n",(0,r.jsx)(n.h4,{id:"failed-restore",children:"Failed restore"}),"\n",(0,r.jsxs)(n.p,{children:["If ",(0,r.jsx)(n.code,{children:"Adapty.restorePurchases()"})," fails, this method will be invoked:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"public func paywallController(\n    _ controller: AdaptyPaywallController, \n    didFailRestoreWith error: AdaptyError\n) { }\n"})}),"\n",(0,r.jsx)(n.h3,{id:"data-fetching-and-rendering",children:"Data fetching and rendering"}),"\n",(0,r.jsx)(n.h4,{id:"product-loading-errors",children:"Product loading errors"}),"\n",(0,r.jsx)(n.p,{children:"If you don't pass the product array during the initialization, AdaptyUI will retrieve the necessary objects from the server by itself. If this operation fails, AdaptyUI will report the error by calling this method:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"public func paywallController(\n    _ controller: AdaptyPaywallController,\n    didFailLoadingProductsWith error: AdaptyError\n) -> Bool {\n    return true\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["If you return ",(0,r.jsx)(n.code,{children:"true"}),", AdaptyUI will repeat the request after 2 seconds."]}),"\n",(0,r.jsx)(n.h4,{id:"rendering-errors",children:"Rendering errors"}),"\n",(0,r.jsx)(n.p,{children:"If an error occurs during the interface rendering, it will be reported by this method:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:"public func paywallController(\n    _ controller: AdaptyPaywallController,\n    didFailRenderingWith error: AdaptyError\n) { }\n"})}),"\n",(0,r.jsx)(n.p,{children:"In a normal situation, such errors should not occur, so if you come across one, please let us know."}),"\n",(0,r.jsx)(n.h2,{id:"handling-events-in-swiftui",children:"Handling events in SwiftUI"}),"\n",(0,r.jsxs)(n.p,{children:["To control or monitor processes occurring on the paywall screen within your mobile app, use the ",(0,r.jsx)(n.code,{children:".paywall"})," modifier in SwiftUI:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-swift",metastring:'showLineNumbers title="Swift"',children:'@State var paywallPresented = false\n\nvar body: some View {\n\tText("Hello, AdaptyUI!")\n\t\t\t.paywall(\n          isPresented: $paywallPresented,\n          paywall: paywall,\n          viewConfiguration: viewConfig,\n          didPerformAction: { action in\n              switch action {\n                  case .close:\n                      paywallPresented = false\n                  case let .openURL(url):\n                      // handle opening the URL (incl. for terms and privacy)\n                  default:\n                      // handle other actions\n              }\n          },\n          didSelectProduct: { /* Handle the event */  },\n          didStartPurchase: { /* Handle the event */ },\n          didFinishPurchase: { product, info in /* Handle the event */ },\n          didFailPurchase: { product, error in /* Handle the event */ },\n          didStartRestore: { /* Handle the event */ },\n          didFinishRestore: { /* Handle the event */ },\n          didFailRestore: { /* Handle the event */ },\n          didFailRendering: { error in\n              paywallPresented = false\n          },\n          didFailLoadingProducts: { error in\n              return false\n          }\n      )\n}\n'})}),"\n",(0,r.jsx)(n.p,{children:"You can register only the closure parameters you need, and omit those you do not need. In this case, unused closure parameters will not be created."}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Closure parameter"}),(0,r.jsx)(n.th,{style:{textAlign:"left"},children:"Description"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didSelectProduct"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If a user selects a product for purchase, this parameter will be invoked."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didStartPurchase"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If a user initiates the purchase process, this parameter will be invoked."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didFinishPurchase"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["If ",(0,r.jsx)(n.code,{children:"Adapty.makePurchase()"})," succeeds or is cancelled by the user, this parameter will be invoked."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didFailPurchase"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If Adapty.makePurchase() fails, this parameter will be invoked."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didStartRestore"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If a user initiates the purchase restoration, this parameter will be invoked."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didFinishRestore"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["If ",(0,r.jsx)(n.code,{children:"Adapty.restorePurchases()"})," succeeds, this parameter will be invoked."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didFailRestore"})}),(0,r.jsxs)(n.td,{style:{textAlign:"left"},children:["If ",(0,r.jsx)(n.code,{children:"Adapty.restorePurchases()"})," fails, this parameter will be invoked."]})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didFailRendering"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If an error occurs during the interface rendering, this parameter will be invoked."})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{style:{textAlign:"left"},children:(0,r.jsx)(n.strong,{children:"didFailLoadingProducts"})}),(0,r.jsx)(n.td,{style:{textAlign:"left"},children:"If you don't pass the product array during the initialization, AdaptyUI will retrieve the necessary objects from the server by itself. If this operation fails, AdaptyUI will invoke this parameter."})]})]})]}),"\n",(0,r.jsxs)(n.p,{children:["Note that at the very least you need to implement the reactions to both ",(0,r.jsx)(n.code,{children:"close"})," and ",(0,r.jsx)(n.code,{children:"openURL"}),"."]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},97808:(e,n,t)=>{t.d(n,{Ay:()=>a,RM:()=>l});var r=t(74848),i=t(28453);const l=[];function s(e){const n={a:"a",admonition:"admonition",p:"p",...(0,i.R)(),...e.components};return(0,r.jsx)(n.admonition,{type:"tip",children:(0,r.jsxs)(n.p,{children:["Want to see a real-world example of how Adapty SDK is integrated into a mobile app? Check out our ",(0,r.jsx)(n.a,{href:"sample-apps",children:"sample apps"}),", which demonstrate the full setup, including displaying paywalls, making purchases, and other basic functionality."]})})}function a(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(s,{...e})}):s(e)}}}]);